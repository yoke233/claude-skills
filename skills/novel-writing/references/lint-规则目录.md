# 小说 Lint 规则目录

> **唯一数据源**：所有规则 ID、阈值、严重级别以本文件为准。禁止在其他文件维护同一条规则的不同版本。
>
> **配合使用**：本规则目录是 novel-writing 技能的一部分，依赖其目录结构（`novel-memory/`）和模板定义。

---

## 执行模式

| 模式 | 触发场景 | 执行规则 | 输出 |
|------|---------|---------|------|
| paragraph | 快速审核单段 | `PR-*` | 该段 error/warn/info + 修复建议 |
| chapter | 定稿前完整审核 | `CH-*` + `PR-*` 抽样 | PASS / PASS_WITH_WARNINGS / BLOCKED |
| repo | 整卷/全书巡检 | 全部规则按卷批量 | 按规则 ID 聚合的统计报表 |

### 门禁策略

- `error > 0` → **BLOCKED**（不可宣称通过）
- `error = 0 且 warn > 0` → **PASS_WITH_WARNINGS**
- `error = 0 且 warn = 0` → **PASS**

---

## 1) 章节规则（CH-*）

### Frontmatter（CH-FM）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| CH-FM-001 | error | frontmatter 可解析 | YAML 无法解析 | 修复 frontmatter 语法 |
| CH-FM-002 | error | 必填字段完整 | 缺少 `章节号/所属卷/视角角色/场景地点/故事内时间/状态/字数/出场角色/涉及情节线/摘要` 任一字段 | 补齐缺失字段 |
| CH-FM-003 | error | 状态枚举合法 | `状态` 不在 `大纲/初稿/修改/定稿` | 改为合法值 |
| CH-FM-004 | error | 摘要长度限制 | frontmatter `摘要` 超过 200 字 | 压缩为 200 字以内 |
| CH-FM-005 | error | 字数有效 | `字数` 字段 ≤ 0 或缺失 | 填写实际字数 |
| CH-FM-006 | error | 出场角色非空 | `出场角色` 列表为空 | 填写本章出场角色 |

### 路径与命名（CH-PATH）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| CH-PATH-001 | error | 路径结构合法 | 文件不在 `50-正文/卷X/` 下 | 移到规范目录 |
| CH-PATH-002 | warn | 文件命名规范 | 文件名不匹配 `章XXX.md` 格式（如 `章001.md`） | 改为 `章XXX.md` |

### 模板结构（CH-TPL）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| CH-TPL-001 | error | 必要区块完整 | 缺少 `本章概要/场景列表/本章伏笔/本章引发的设定变更` | 补齐区块 |
| CH-TPL-002 | error | 场景字段完整 | 任一场景缺 `地点/出场角色/目标/冲突/结果` | 补齐场景字段 |
| CH-TPL-003 | warn | 场景数量合理 | 场景数量 <1 或 >8 | 调整场景粒度 |

### 跨文件同步（CH-SYNC）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| CH-SYNC-001 | error | 章节摘要总表同步 | `状态=定稿` 且 `45-连续性/章节摘要总表.md` 缺本章行 | 追加本章摘要行 |
| CH-SYNC-002 | error | 角色索引一致 | `出场角色` 在 `20-角色/_角色索引.md` 未登记 | 登记角色或修正角色名 |
| CH-SYNC-003 | error | 情节线一致 | `涉及情节线` 在 `30-情节/主线.md` 不存在 | 登记情节线或修正名称 |
| CH-SYNC-004 | error | 伏笔追踪同步 | 本章标注埋设/强化/回收但 `30-情节/伏笔追踪表.md` 无对应更新 | 同步追踪表 |
| CH-SYNC-005 | warn | 时间线同步 | `状态=定稿` 但时间线文件未出现本章事件 | 补充时间线 |
| CH-SYNC-006 | error | 角色动态状态更新 | `状态=定稿` 但出场角色的「动态状态」区「最后更新章节」非本章 | 更新角色动态状态 |
| CH-SYNC-007 | warn | 卷大纲同步 | `状态=定稿` 但卷大纲钩子/情绪事件行未更新实际执行记录 | 同步卷大纲 |
| CH-SYNC-008 | warn | 情节线进展更新 | `状态=定稿` 但 `主线.md` 活跃情节线无本章进展 | 更新情节线 |

### 章级检查（CH-CHECK）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| CH-CHECK-001 | warn | 设定变更清单闭环 | `状态=定稿` 仍有未完成待办项 | 完成或说明豁免 |

---

## 2) 段落规则（PR-*）

### 格式（PR-FMT）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-FMT-001 | error | 引号配对 | 中文/英文引号不成对 | 修复配对 |
| PR-FMT-002 | error | 段落结构 | 目标段为空或只含标点 | 补充有效内容 |

### 长度（PR-LEN）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-LEN-001 | warn | 叙述段长度 | 叙述段 > 150 字 | 拆段并保留节奏 |
| PR-LEN-002 | warn | 对话段长度 | 对话段 > 120 字 | 拆分台词与动作拍 |
| PR-LEN-003 | warn | 动作段长度 | 动作段 > 80 字 | 缩短句长与说明 |

### 标点（PR-PUNC）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-PUNC-001 | warn | 破折号密度（段级） | 单段破折号 > 1 | 删除冗余破折号 |
| PR-PUNC-002 | warn | 破折号密度（章级） | 全章破折号 > 5 | 削减至 ≤5 |
| PR-PUNC-003 | info | 感叹号密度 | 单段 `！` > 2 | 降低情绪标点依赖 |

### AI 味检测（PR-AI）

> 词表来源：`references/去AI味指南.md` 第一节「高频废词」。

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-AI-001 | warn | 高频废词重复 | 同一废词在**同一章**出现 ≥2 次 | 替换为具体动作/感官描写 |
| PR-AI-002 | warn | 句式重复 | 连续 3 句同起始模式 | 调整句型与节奏 |
| PR-AI-003 | warn | 抽象词堆叠 | 抽象情绪词连续堆叠 | 用动作和场景替代 |
| PR-AI-004 | warn | 概述句代替展示 | 出现「他感到…」「她意识到…」等 tell-not-show 句式 | 改为具体行为/感官 |
| PR-AI-005 | warn | 伪深刻总结句 | 章末/段末出现「这一刻，他终于明白了…」类句式 | 删除，用行动体现 |

### 对话（PR-DLG）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-DLG-001 | warn | 对话标签过密 | 连续 3 句对话每句都有「X说/X道」 | 用动作拍替换标签 |
| PR-DLG-002 | warn | 标签动词单一 | 同一场景内 ≥3 次使用同一标签动词（如「说道」） | 换为差异化动词或动作拍 |

### 感官与信息（PR-SENS / PR-INFO）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-SENS-001 | warn | 感官覆盖不足 | **单场景**内感官维度 < 3 类（视觉至少 + 其他 2 种） | 补充触觉/听觉/嗅觉等 |
| PR-INFO-001 | warn | 设定注入过量 | 单场景引入 > 1 条新设定 | 控制为 1 条并自然化 |

### MRU 与重复度（PR-MRU / PR-REP）

| ID | Severity | 检查项 | 失败条件 | 修复建议 |
|----|----------|--------|----------|----------|
| PR-MRU-001 | info | MRU 顺序倾向 | 反应段明显违背「感受→动作→对话」 | 调整反应顺序 |
| PR-REP-001 | warn | 局部重复度 | 与相邻段落高重复（8-gram） | 去重并重写关键句 |

---

## 3) 严重级别与升级准则

- **error**：确定性、可证明、低争议，适合门禁阻断。
- **warn**：启发式、存在少量误报，不阻断。
- **info**：质量建议，仅用于提示。

### 升级流程

1. 新规则先上线 `warn`。
2. 连续两轮人工复核误报率 < 5% 后，再考虑升为 `error`。
3. 升级时必须记录变更原因与样本依据。

---

## 4) 输出格式

```markdown
## Lint Result
- Scope: chapter | paragraph | repo
- Target: <文件或范围>
- Status: PASS | PASS_WITH_WARNINGS | BLOCKED
- Counts: error=X, warn=Y, info=Z

## Findings
| Rule ID | Severity | Location | Evidence | Suggestion |
|---------|----------|----------|----------|------------|
| CH-FM-002 | error | 50-正文/卷一/章001.md:1 | 缺少字段 `状态` | 在 frontmatter 补齐 |
```

---

## 5) 与工作流的集成点

| 工作流阶段 | 执行的 lint 规则 | 执行者 |
|-----------|-----------------|--------|
| 阶段一·五 文笔审稿人 | `PR-*` 全部 | 文笔审稿子代理 |
| 阶段二 写后即录合规审查 | `CH-PATH-*` + `CH-TPL-*` + `CH-FM-*` + `CH-SYNC-*` + `CH-CHECK-*` | 合规审查子代理 |
| 阶段三 卷间审查 | repo 模式全部规则 | 卷间审查子代理 |
